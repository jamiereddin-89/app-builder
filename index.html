
<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Made on Vibes DIY</title>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
      }
      #container {
        width: 100%;
        height: 100vh;
      }
    </style>
  </head>
  <body>
    <div id="container"></div>
    <script>
      window.CALLAI_API_KEY = "";
      window.CALLAI_CHAT_URL = "https://vibes-diy-api.com/";
      window.CALLAI_IMG_URL = "https://vibes-diy-api.com/";
    </script>
    <script type="importmap">
      {
  "imports": {
    "react": "https://esm.sh/react",
    "react-dom": "https://esm.sh/react-dom",
    "react-dom/client": "https://esm.sh/react-dom/client",
    "react/jsx-runtime": "https://esm.sh/react/jsx-runtime",
    "use-fireproof": "https://esm.sh/use-vibes@0.18.9",
    "call-ai": "https://esm.sh/call-ai@0.18.9",
    "use-vibes": "https://esm.sh/use-vibes@0.18.9",
    "https://esm.sh/use-fireproof": "https://esm.sh/use-vibes@0.18.9",
    "https://esm.sh/use-vibes": "https://esm.sh/use-vibes@0.18.9"
  }
}
    </script>
    <script type="text/babel" data-type="module">
      import ReactDOMClient from "react-dom/client";

      // prettier-ignore
      import React, { useState, useEffect, useRef } from "react";
import { useFireproof } from "use-fireproof";

export default function App() {
  const { useLiveQuery, database } = useFireproof("puter-apps-v6");
  const { docs: apps } = useLiveQuery("type", { key: "app", descending: true });
  const { docs: versions } = useLiveQuery("type", { key: "version", descending: true });
  
  const [prompt, setPrompt] = useState("");
  const [appName, setAppName] = useState("");
  const [appTitle, setAppTitle] = useState("");
  const [generating, setGenerating] = useState(false);
  const [selectedApp, setSelectedApp] = useState(null);
  const [editCode, setEditCode] = useState("");
  const [models, setModels] = useState([]);
  const [model, setModel] = useState("gpt-4o-mini");
  const [provider, setProvider] = useState("All");
  const [puter, setPuter] = useState(null);
  const [user, setUser] = useState(null);
  const [log, setLog] = useState([]);
  const [showCode, setShowCode] = useState(false);
  
  // New feature states
  const [searchQuery, setSearchQuery] = useState("");
  const [selectedTemplate, setSelectedTemplate] = useState(null);
  const [showTemplates, setShowTemplates] = useState(false);
  const [showVersions, setShowVersions] = useState(false);
  const [selectedApps, setSelectedApps] = useState(new Set());
  const [bulkMode, setBulkMode] = useState(false);
  const [sortBy, setSortBy] = useState("date");
  const [filterFavorites, setFilterFavorites] = useState(false);
  const [showAnalytics, setShowAnalytics] = useState(false);
  const [showExportModal, setShowExportModal] = useState(false);
  const [showShareModal, setShowShareModal] = useState(false);
  const [shareLink, setShareLink] = useState("");
  const [activeTab, setActiveTab] = useState("build");
  const fileInputRef = useRef(null);

  // Templates
  const templates = [
    { id: "todo", name: "Todo App", icon: "‚úÖ", prompt: "A beautiful todo app with categories, priorities, due dates, dark/light mode toggle, and local storage persistence" },
    { id: "calculator", name: "Calculator", icon: "üî¢", prompt: "A scientific calculator with history, memory functions, keyboard support, and a sleek modern UI" },
    { id: "notes", name: "Notes App", icon: "üìù", prompt: "A notes app with markdown support, folders, search, tags, and auto-save functionality" },
    { id: "timer", name: "Pomodoro Timer", icon: "‚è±Ô∏è", prompt: "A pomodoro timer with customizable work/break intervals, statistics, sounds, and notifications" },
    { id: "weather", name: "Weather Dashboard", icon: "üå§Ô∏è", prompt: "A weather dashboard that shows current conditions, 5-day forecast, with beautiful animations and location search" },
    { id: "kanban", name: "Kanban Board", icon: "üìã", prompt: "A kanban board with drag-and-drop cards, multiple columns, labels, and local storage" },
    { id: "password", name: "Password Generator", icon: "üîê", prompt: "A password generator with strength meter, customizable options, copy to clipboard, and password history" },
    { id: "quiz", name: "Quiz Game", icon: "üéØ", prompt: "An interactive quiz game with multiple categories, scoring, timer, and leaderboard" },
    { id: "expense", name: "Expense Tracker", icon: "üí∞", prompt: "An expense tracker with categories, charts, monthly budgets, and export functionality" },
    { id: "drawing", name: "Drawing App", icon: "üé®", prompt: "A drawing canvas with brush sizes, colors, shapes, layers, undo/redo, and save as image" },
    { id: "music", name: "Music Player", icon: "üéµ", prompt: "A music player UI with playlist, progress bar, volume control, shuffle, and visualizer" },
    { id: "chat", name: "Chat Interface", icon: "üí¨", prompt: "A chat interface with message bubbles, typing indicators, timestamps, and emoji picker" },
  ];

  const addLog = (msg) => setLog(prev => [...prev.slice(-15), `${new Date().toLocaleTimeString()}: ${msg}`]);
  const displayCode = editCode || selectedApp?.code || "";

  // Filter and sort apps
  const filteredApps = apps
    .filter(app => {
      if (filterFavorites && !app.favorite) return false;
      if (searchQuery) {
        const q = searchQuery.toLowerCase();
        return (
          app.appName?.toLowerCase().includes(q) ||
          app.appTitle?.toLowerCase().includes(q) ||
          app.prompt?.toLowerCase().includes(q)
        );
      }
      return true;
    })
    .sort((a, b) => {
      if (sortBy === "date") return (b.createdAt || 0) - (a.createdAt || 0);
      if (sortBy === "name") return (a.appTitle || a.appName || "").localeCompare(b.appTitle || b.appName || "");
      if (sortBy === "views") return (b.views || 0) - (a.views || 0);
      return 0;
    });

  // App analytics
  const analytics = {
    totalApps: apps.length,
    totalVersions: versions.filter(v => selectedApp && v.appId === selectedApp._id).length,
    favorites: apps.filter(a => a.favorite).length,
    totalViews: apps.reduce((sum, a) => sum + (a.views || 0), 0),
    modelsUsed: [...new Set(apps.map(a => a.model))].length,
    avgCodeSize: apps.length ? Math.round(apps.reduce((sum, a) => sum + (a.code?.length || 0), 0) / apps.length) : 0
  };

  useEffect(() => {
    const script = document.createElement("script");
    script.src = "https://js.puter.com/v2/";
    script.onload = async () => {
      setPuter(window.puter);
      addLog("SDK ready");
      if (window.puter.auth.isSignedIn()) {
        const u = await window.puter.auth.getUser();
        setUser(u);
        addLog(`Welcome ${u.username}`);
      }
    };
    document.body.appendChild(script);
    
    fetch("https://api.puter.com/puterai/chat/models/")
      .then(r => r.json())
      .then(data => {
        const list = (Array.isArray(data) ? data : data.models || []).map(m => {
          const id = typeof m === "string" ? m : m.id;
          let prov = "Other";
          if (/gpt|o1|o3|chatgpt/i.test(id)) prov = "OpenAI";
          else if (/claude/i.test(id)) prov = "Anthropic";
          else if (/gemini|gemma/i.test(id)) prov = "Google";
          else if (/llama/i.test(id)) prov = "Meta";
          else if (/mistral|mixtral/i.test(id)) prov = "Mistral";
          else if (/deepseek/i.test(id)) prov = "DeepSeek";
          else if (/grok/i.test(id)) prov = "xAI";
          else if (/qwen/i.test(id)) prov = "Alibaba";
          return { id, provider: prov };
        });
        setModels(list);
      })
      .catch(() => {});
  }, []);

  const providers = ["All", ...new Set(models.map(m => m.provider))].sort();
  const filtered = provider === "All" ? models : models.filter(m => m.provider === provider);

  async function signIn() {
    if (!puter) return;
    await puter.auth.signIn();
    const u = await puter.auth.getUser();
    setUser(u);
    addLog(`Welcome ${u.username}`);
  }

  async function buildAndDeploy(customPrompt) {
    const finalPrompt = customPrompt || prompt;
    if (!finalPrompt.trim() || !puter || !user) return;
    setGenerating(true);
    setSelectedApp(null);
    setEditCode("");
    setLog([]);
    setShowTemplates(false);
    
    try {
      addLog(`Model: ${model}`);
      addLog("Generating code...");

      const systemPrompt = `You are an expert web developer. Create a COMPLETE single HTML file app.
RULES:
- Start with <!DOCTYPE html>
- ALL CSS in <style> tag, ALL JS in <script> tag
- Modern CSS: variables, flexbox/grid, animations, gradients
- Modern JS: ES6+, localStorage, event handling
- Responsive and polished UI
- NO external dependencies
- Return ONLY HTML code`;

      const res = await puter.ai.chat([
        { role: "system", content: systemPrompt },
        { role: "user", content: `Build: ${finalPrompt}` }
      ], { model });

      let code = res?.message?.content || res?.text || res?.content || String(res);
      code = code.replace(/```html?\n?/gi, "").replace(/```\n?/g, "").trim();
      const start = code.search(/<!doctype\s+html>/i);
      if (start > 0) code = code.slice(start);
      if (!code.toLowerCase().includes("<!doctype html>")) throw new Error("Invalid HTML");

      addLog(`Generated ${code.length} bytes`);
      
      addLog("Creating directory...");
      const dirName = `app_${Date.now()}`;
      await puter.fs.mkdir(dirName);
      await puter.fs.write(`${dirName}/index.html`, code);
      addLog(`Wrote to ${dirName}/index.html`);

      addLog("Creating hosted site...");
      const subdomain = appName.trim().toLowerCase().replace(/[^a-z0-9-]/g, "") || puter.randName();
      const site = await puter.hosting.create(subdomain, dirName);
      const hostedUrl = `https://${site.subdomain}.puter.site`;
      addLog(`Hosted at: ${hostedUrl}`);

      addLog("Registering Puter app...");
      const finalAppName = appName.trim() || puter.randName();
      const finalAppTitle = appTitle.trim() || finalPrompt.slice(0, 50);
      
      let puterApp;
      try {
        puterApp = await puter.apps.create({
          name: finalAppName,
          indexURL: hostedUrl,
          title: finalAppTitle,
          description: finalPrompt,
          maximizeOnStart: true,
          dedupeName: true
        });
        addLog(`App registered: ${puterApp.name}`);
      } catch (appErr) {
        addLog(`Name taken, using random...`);
        const randomName = puter.randName();
        puterApp = await puter.apps.create({
          name: randomName,
          indexURL: hostedUrl,
          title: finalAppTitle,
          description: finalPrompt,
          maximizeOnStart: true
        });
        addLog(`App registered: ${puterApp.name}`);
      }

      addLog("Saving to database...");
      const doc = await database.put({
        type: "app",
        prompt: finalPrompt,
        code,
        subdomain: site.subdomain,
        hostedUrl,
        appName: puterApp.name,
        appUid: puterApp.uid,
        appTitle: finalAppTitle,
        model,
        dir: dirName,
        createdAt: Date.now(),
        views: 0,
        favorite: false,
        tags: [],
        version: 1
      });

      // Save initial version
      await database.put({
        type: "version",
        appId: doc.id,
        code,
        version: 1,
        createdAt: Date.now(),
        note: "Initial version"
      });

      const saved = await database.get(doc.id);
      setSelectedApp(saved);
      setAppName("");
      setAppTitle("");
      setPrompt("");
      setSelectedTemplate(null);
      addLog("‚úÖ Complete!");
      window.open(hostedUrl, "_blank");

    } catch (err) {
      addLog(`‚ùå Error: ${err.message}`);
    }
    setGenerating(false);
  }

  async function updateAndRedeploy() {
    if (!selectedApp || !editCode || !puter) return;
    setGenerating(true);
    try {
      addLog("Updating...");
      
      const dirName = `app_${Date.now()}`;
      await puter.fs.mkdir(dirName);
      await puter.fs.write(`${dirName}/index.html`, editCode);
      
      try { await puter.hosting.delete(selectedApp.subdomain); } catch (e) {}
      const site = await puter.hosting.create(selectedApp.subdomain, dirName);
      const hostedUrl = `https://${site.subdomain}.puter.site`;
      
      if (selectedApp.appName) {
        try {
          await puter.apps.update(selectedApp.appName, { indexURL: hostedUrl });
          addLog(`Updated app: ${selectedApp.appName}`);
        } catch (e) {}
      }

      const newVersion = (selectedApp.version || 1) + 1;
      
      // Save version history
      await database.put({
        type: "version",
        appId: selectedApp._id,
        code: editCode,
        version: newVersion,
        createdAt: Date.now(),
        note: `Version ${newVersion}`
      });
      
      await database.put({ 
        ...selectedApp, 
        code: editCode, 
        dir: dirName, 
        hostedUrl, 
        updatedAt: Date.now(),
        version: newVersion
      });
      
      const updated = await database.get(selectedApp._id);
      setSelectedApp(updated);
      setEditCode("");
      addLog(`‚úÖ Updated to v${newVersion}`);
      window.open(hostedUrl, "_blank");
    } catch (err) {
      addLog(`‚ùå Error: ${err.message}`);
    }
    setGenerating(false);
  }

  async function deleteApp(app, e) {
    e?.stopPropagation();
    try {
      addLog(`Deleting ${app.appName || app.subdomain}...`);
      if (app.appName) {
        try { await puter.apps.delete(app.appName); } catch (e) {}
      }
      if (app.subdomain) {
        try { await puter.hosting.delete(app.subdomain); } catch (e) {}
      }
      // Delete versions
      const appVersions = versions.filter(v => v.appId === app._id);
      for (const v of appVersions) {
        await database.del(v._id);
      }
      await database.del(app._id);
      if (selectedApp?._id === app._id) { 
        setSelectedApp(null); 
        setEditCode(""); 
      }
      addLog("‚úÖ Deleted");
    } catch (e) {
      addLog(`‚ùå Error: ${e.message}`);
    }
  }

  async function bulkDelete() {
    if (selectedApps.size === 0) return;
    for (const appId of selectedApps) {
      const app = apps.find(a => a._id === appId);
      if (app) await deleteApp(app);
    }
    setSelectedApps(new Set());
    setBulkMode(false);
  }

  async function toggleFavorite(app, e) {
    e?.stopPropagation();
    await database.put({ ...app, favorite: !app.favorite });
    if (selectedApp?._id === app._id) {
      setSelectedApp({ ...app, favorite: !app.favorite });
    }
  }

  async function incrementViews(app) {
    await database.put({ ...app, views: (app.views || 0) + 1 });
  }

  async function launchApp(app, e) {
    e?.stopPropagation();
    await incrementViews(app);
    if (app.appName && puter) {
      try {
        await puter.apps.launch(app.appName);
        addLog(`Launched: ${app.appName}`);
      } catch (err) {
        window.open(app.hostedUrl, "_blank");
      }
    } else {
      window.open(app.hostedUrl, "_blank");
    }
  }

  async function restoreVersion(version) {
    if (!selectedApp) return;
    setEditCode(version.code);
    addLog(`Restored v${version.version}`);
    setShowVersions(false);
  }

  function exportApps() {
    const data = JSON.stringify(apps, null, 2);
    const blob = new Blob([data], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `puter-apps-export-${Date.now()}.json`;
    a.click();
    URL.revokeObjectURL(url);
    addLog("‚úÖ Exported apps");
    setShowExportModal(false);
  }

  function exportSingleApp(app) {
    const data = JSON.stringify(app, null, 2);
    const blob = new Blob([data], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `${app.appName || "app"}-export.json`;
    a.click();
    URL.revokeObjectURL(url);
    addLog(`‚úÖ Exported ${app.appName}`);
  }

  async function importApps(e) {
    const file = e.target.files[0];
    if (!file) return;
    const text = await file.text();
    try {
      const imported = JSON.parse(text);
      const appsToImport = Array.isArray(imported) ? imported : [imported];
      for (const app of appsToImport) {
        delete app._id;
        app.imported = true;
        app.createdAt = Date.now();
        await database.put(app);
      }
      addLog(`‚úÖ Imported ${appsToImport.length} app(s)`);
    } catch (err) {
      addLog(`‚ùå Import failed: ${err.message}`);
    }
    e.target.value = "";
    setShowExportModal(false);
  }

  function generateShareLink(app) {
    const encoded = btoa(JSON.stringify({ 
      prompt: app.prompt, 
      code: app.code, 
      title: app.appTitle 
    }));
    const link = `${window.location.origin}?share=${encoded}`;
    setShareLink(link);
    setShowShareModal(true);
  }

  function copyShareLink() {
    navigator.clipboard.writeText(shareLink);
    addLog("‚úÖ Link copied!");
  }

  function selectTemplate(template) {
    setSelectedTemplate(template);
    setPrompt(template.prompt);
    setAppTitle(template.name);
    setShowTemplates(false);
  }

  const appVersions = selectedApp ? versions.filter(v => v.appId === selectedApp._id).sort((a, b) => b.version - a.version) : [];

  // Neomorphic styles
  const neu = "bg-[#e8e8e8] shadow-[8px_8px_16px_#c5c5c5,-8px_-8px_16px_#ffffff]";
  const neuInset = "bg-[#e8e8e8] shadow-[inset_4px_4px_8px_#c5c5c5,inset_-4px_-4px_8px_#ffffff]";
  const neuBtn = "bg-[#e8e8e8] shadow-[5px_5px_10px_#c5c5c5,-5px_-5px_10px_#ffffff] hover:shadow-[2px_2px_5px_#c5c5c5,-2px_-2px_5px_#ffffff] active:shadow-[inset_4px_4px_8px_#c5c5c5,inset_-4px_-4px_8px_#ffffff] transition-all duration-150";
  const neuBtnRed = "bg-[#dc2626] text-white shadow-[5px_5px_10px_#c5c5c5,-5px_-5px_10px_#ffffff] hover:shadow-[2px_2px_5px_#c5c5c5,-2px_-2px_5px_#ffffff] active:shadow-[inset_4px_4px_8px_#b91c1c,inset_-4px_-4px_8px_#ef4444] transition-all duration-150";
  const neuBtnBlack = "bg-[#1a1a1a] text-white shadow-[5px_5px_10px_#c5c5c5,-5px_-5px_10px_#ffffff] hover:shadow-[2px_2px_5px_#c5c5c5,-2px_-2px_5px_#ffffff] active:shadow-[inset_4px_4px_8px_#000,inset_-4px_-4px_8px_#333] transition-all duration-150";

  return (
    <div className="min-h-screen bg-[#e8e8e8] p-4 md:p-6">
      <div className="max-w-7xl mx-auto space-y-6">
        
        {/* Header */}
        <div className={`${neu} rounded-[24px] p-5`}>
          <div className="flex flex-wrap items-center justify-between gap-4">
            <div>
              <h1 className="text-2xl md:text-3xl font-black text-[#1a1a1a] flex items-center gap-2">
                <span className="text-[#dc2626]">‚ö°</span> PUTER APP FACTORY
              </h1>
              <p className="text-[#666] text-sm mt-1">{models.length} models ‚Ä¢ {apps.length} apps ‚Ä¢ {analytics.totalViews} views</p>
            </div>
            <div className="flex items-center gap-3">
              {user && (
                <>
                  <button onClick={() => setShowAnalytics(!showAnalytics)}
                    className={`${neuBtn} rounded-full px-4 py-2 font-bold text-[#1a1a1a] text-sm`}>
                    üìä
                  </button>
                  <button onClick={() => setShowExportModal(true)}
                    className={`${neuBtn} rounded-full px-4 py-2 font-bold text-[#1a1a1a] text-sm`}>
                    üì¶
                  </button>
                </>
              )}
              {user ? (
                <div className="flex items-center gap-3">
                  <div className={`${neuInset} rounded-full px-4 py-2`}>
                    <span className="font-bold text-[#1a1a1a] text-sm">üë§ {user.username}</span>
                  </div>
                  <button onClick={() => { puter.auth.signOut(); setUser(null); }}
                    className={`${neuBtn} rounded-full px-4 py-2 font-bold text-[#1a1a1a] text-sm`}>
                    Logout
                  </button>
                </div>
              ) : (
                <button onClick={signIn} disabled={!puter}
                  className={`${neuBtnRed} rounded-full px-6 py-3 font-black disabled:opacity-50`}>
                  Sign In Free
                </button>
              )}
            </div>
          </div>

          {/* Analytics Panel */}
          {showAnalytics && (
            <div className="mt-6 grid grid-cols-2 md:grid-cols-6 gap-4">
              {[
                { label: "Total Apps", value: analytics.totalApps, icon: "üì±" },
                { label: "Favorites", value: analytics.favorites, icon: "‚≠ê" },
                { label: "Total Views", value: analytics.totalViews, icon: "üëÅÔ∏è" },
                { label: "Models Used", value: analytics.modelsUsed, icon: "ü§ñ" },
                { label: "Avg Code Size", value: `${(analytics.avgCodeSize / 1024).toFixed(1)}KB`, icon: "üìÑ" },
                { label: "Versions", value: versions.length, icon: "üìö" },
              ].map((stat, i) => (
                <div key={i} className={`${neuInset} rounded-2xl p-4 text-center`}>
                  <div className="text-2xl mb-1">{stat.icon}</div>
                  <div className="font-black text-[#1a1a1a] text-xl">{stat.value}</div>
                  <div className="text-[#666] text-xs">{stat.label}</div>
                </div>
              ))}
            </div>
          )}
        </div>

        {/* Export/Import Modal */}
        {showExportModal && (
          <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" onClick={() => setShowExportModal(false)}>
            <div className={`${neu} rounded-[24px] p-6 max-w-md w-full`} onClick={e => e.stopPropagation()}>
              <h3 className="font-black text-[#1a1a1a] text-xl mb-4">üì¶ Export / Import</h3>
              <div className="space-y-3">
                <button onClick={exportApps} className={`w-full ${neuBtn} rounded-xl py-3 font-bold text-[#1a1a1a]`}>
                  üì§ Export All Apps (JSON)
                </button>
                <button onClick={() => fileInputRef.current?.click()} className={`w-full ${neuBtn} rounded-xl py-3 font-bold text-[#1a1a1a]`}>
                  üì• Import Apps (JSON)
                </button>
                <input ref={fileInputRef} type="file" accept=".json" onChange={importApps} className="hidden" />
              </div>
              <button onClick={() => setShowExportModal(false)} className={`w-full ${neuBtnBlack} rounded-xl py-3 font-bold mt-4`}>
                Close
              </button>
            </div>
          </div>
        )}

        {/* Share Modal */}
        {showShareModal && (
          <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" onClick={() => setShowShareModal(false)}>
            <div className={`${neu} rounded-[24px] p-6 max-w-lg w-full`} onClick={e => e.stopPropagation()}>
              <h3 className="font-black text-[#1a1a1a] text-xl mb-4">üîó Share App</h3>
              <div className={`${neuInset} rounded-xl p-3 mb-4`}>
                <input value={shareLink} readOnly className="w-full bg-transparent text-xs font-mono text-[#1a1a1a] outline-none" />
              </div>
              <div className="flex gap-3">
                <button onClick={copyShareLink} className={`flex-1 ${neuBtnRed} rounded-xl py-3 font-bold`}>
                  üìã Copy Link
                </button>
                <button onClick={() => setShowShareModal(false)} className={`flex-1 ${neuBtnBlack} rounded-xl py-3 font-bold`}>
                  Close
                </button>
              </div>
            </div>
          </div>
        )}

        {/* Version History Modal */}
        {showVersions && selectedApp && (
          <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" onClick={() => setShowVersions(false)}>
            <div className={`${neu} rounded-[24px] p-6 max-w-md w-full max-h-[80vh] overflow-hidden`} onClick={e => e.stopPropagation()}>
              <h3 className="font-black text-[#1a1a1a] text-xl mb-4">üìö Version History</h3>
              <div className="space-y-2 max-h-[50vh] overflow-y-auto">
                {appVersions.length === 0 ? (
                  <p className="text-[#666] text-center py-4">No versions saved yet</p>
                ) : (
                  appVersions.map(v => (
                    <div key={v._id} className={`${neuInset} rounded-xl p-3 flex justify-between items-center`}>
                      <div>
                        <div className="font-bold text-[#1a1a1a]">Version {v.version}</div>
                        <div className="text-[#666] text-xs">{new Date(v.createdAt).toLocaleString()}</div>
                      </div>
                      <button onClick={() => restoreVersion(v)} className={`${neuBtn} rounded-full px-3 py-1 text-sm font-bold text-[#1a1a1a]`}>
                        Restore
                      </button>
                    </div>
                  ))
                )}
              </div>
              <button onClick={() => setShowVersions(false)} className={`w-full ${neuBtnBlack} rounded-xl py-3 font-bold mt-4`}>
                Close
              </button>
            </div>
          </div>
        )}

        {/* Templates Modal */}
        {showTemplates && (
          <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4" onClick={() => setShowTemplates(false)}>
            <div className={`${neu} rounded-[24px] p-6 max-w-2xl w-full max-h-[80vh] overflow-hidden`} onClick={e => e.stopPropagation()}>
              <h3 className="font-black text-[#1a1a1a] text-xl mb-4">üé® App Templates</h3>
              <div className="grid grid-cols-2 md:grid-cols-3 gap-3 max-h-[60vh] overflow-y-auto">
                {templates.map(t => (
                  <button key={t.id} onClick={() => selectTemplate(t)}
                    className={`${neuBtn} rounded-xl p-4 text-left transition-all ${selectedTemplate?.id === t.id ? "ring-2 ring-[#dc2626]" : ""}`}>
                    <div className="text-3xl mb-2">{t.icon}</div>
                    <div className="font-bold text-[#1a1a1a] text-sm">{t.name}</div>
                  </button>
                ))}
              </div>
              <button onClick={() => setShowTemplates(false)} className={`w-full ${neuBtnBlack} rounded-xl py-3 font-bold mt-4`}>
                Close
              </button>
            </div>
          </div>
        )}

        {!user ? (
          <div className={`${neu} rounded-[32px] p-12 text-center`}>
            <div className="w-24 h-24 mx-auto mb-6 rounded-full bg-[#dc2626] flex items-center justify-center shadow-[inset_4px_4px_8px_#b91c1c,inset_-4px_-4px_8px_#ef4444]">
              <span className="text-5xl">üöÄ</span>
            </div>
            <h2 className="text-3xl font-black text-[#1a1a1a] mb-3">Build & Deploy Puter Apps</h2>
            <p className="text-[#666] mb-8 max-w-md mx-auto">
              Describe your app ‚Üí AI builds it ‚Üí Deploy as a real Puter app with live URL
            </p>
            <button onClick={signIn} disabled={!puter}
              className={`${neuBtnRed} rounded-full px-10 py-4 font-black text-lg disabled:opacity-50`}>
              Get Started Free
            </button>
          </div>
        ) : (
          <div className="grid lg:grid-cols-3 gap-6">
            
            {/* Left Panel */}
            <div className="space-y-6">
              {/* Tabs */}
              <div className={`${neu} rounded-[24px] p-2 flex gap-2`}>
                {[
                  { id: "build", label: "Build", icon: "üî®" },
                  { id: "apps", label: "Apps", icon: "üì±" },
                ].map(tab => (
                  <button key={tab.id} onClick={() => setActiveTab(tab.id)}
                    className={`flex-1 py-3 rounded-xl font-bold text-sm transition-all ${
                      activeTab === tab.id ? `${neuInset} text-[#dc2626]` : `${neuBtn} text-[#1a1a1a]`}`}>
                    {tab.icon} {tab.label}
                  </button>
                ))}
              </div>

              {activeTab === "build" && (
                <div className={`${neu} rounded-[24px] p-5`}>
                  <button onClick={() => setShowTemplates(true)}
                    className={`w-full ${neuBtn} rounded-xl py-3 font-bold text-[#1a1a1a] mb-4 flex items-center justify-center gap-2`}>
                    üé® Choose Template
                  </button>

                  {selectedTemplate && (
                    <div className={`${neuInset} rounded-xl p-3 mb-4 flex items-center gap-3`}>
                      <span className="text-2xl">{selectedTemplate.icon}</span>
                      <div>
                        <div className="font-bold text-[#1a1a1a] text-sm">{selectedTemplate.name}</div>
                        <button onClick={() => { setSelectedTemplate(null); setPrompt(""); }} className="text-[#dc2626] text-xs">Clear</button>
                      </div>
                    </div>
                  )}
                  
                  <div className="mb-4">
                    <label className="font-black text-[#1a1a1a] text-xs uppercase tracking-wider mb-2 block">Provider</label>
                    <div className="flex flex-wrap gap-2">
                      {providers.slice(0, 6).map(p => (
                        <button key={p} onClick={() => setProvider(p)}
                          className={`px-3 py-1.5 rounded-full text-xs font-bold transition-all ${
                            provider === p 
                              ? "bg-[#dc2626] text-white shadow-[inset_2px_2px_4px_#b91c1c,inset_-2px_-2px_4px_#ef4444]" 
                              : `${neuBtn} text-[#1a1a1a]`}`}>
                          {p}
                        </button>
                      ))}
                    </div>
                  </div>

                  <div className="mb-4">
                    <label className="font-black text-[#1a1a1a] text-xs uppercase tracking-wider mb-2 block">Model</label>
                    <div className={`${neuInset} rounded-2xl p-1`}>
                      <select value={model} onChange={e => setModel(e.target.value)}
                        className="w-full p-3 bg-transparent font-mono text-sm text-[#1a1a1a] border-0 outline-none">
                        {filtered.map(m => <option key={m.id} value={m.id}>{m.id}</option>)}
                      </select>
                    </div>
                  </div>

                  <div className="mb-4">
                    <label className="font-black text-[#1a1a1a] text-xs uppercase tracking-wider mb-2 block">App Description</label>
                    <div className={`${neuInset} rounded-2xl p-1`}>
                      <textarea value={prompt} onChange={e => setPrompt(e.target.value)}
                        placeholder="Describe your app in detail..."
                        className="w-full h-24 p-3 bg-transparent font-mono text-sm text-[#1a1a1a] resize-none border-0 outline-none placeholder-[#999]"
                      />
                    </div>
                  </div>

                  <div className="grid grid-cols-2 gap-3 mb-4">
                    <div>
                      <label className="font-black text-[#1a1a1a] text-xs uppercase tracking-wider mb-2 block">App Name</label>
                      <div className={`${neuInset} rounded-xl p-1`}>
                        <input value={appName} onChange={e => setAppName(e.target.value.toLowerCase().replace(/[^a-z0-9-]/g, ""))}
                          placeholder="my-app"
                          className="w-full p-2 bg-transparent font-mono text-sm text-[#1a1a1a] border-0 outline-none placeholder-[#999]"
                        />
                      </div>
                    </div>
                    <div>
                      <label className="font-black text-[#1a1a1a] text-xs uppercase tracking-wider mb-2 block">Title</label>
                      <div className={`${neuInset} rounded-xl p-1`}>
                        <input value={appTitle} onChange={e => setAppTitle(e.target.value)}
                          placeholder="My App"
                          className="w-full p-2 bg-transparent text-sm text-[#1a1a1a] border-0 outline-none placeholder-[#999]"
                        />
                      </div>
                    </div>
                  </div>

                  <button onClick={() => buildAndDeploy()} disabled={generating || !prompt.trim()}
                    className={`w-full ${neuBtnRed} rounded-2xl py-4 font-black text-lg disabled:opacity-50`}>
                    {generating ? "‚è≥ Building..." : "üöÄ Build & Deploy"}
                  </button>
                </div>
              )}

              {activeTab === "apps" && (
                <div className={`${neu} rounded-[24px] overflow-hidden`}>
                  {/* Search & Filters */}
                  <div className="p-4 space-y-3">
                    <div className={`${neuInset} rounded-xl p-1 flex items-center`}>
                      <span className="pl-3 text-[#999]">üîç</span>
                      <input value={searchQuery} onChange={e => setSearchQuery(e.target.value)}
                        placeholder="Search apps..."
                        className="flex-1 p-2 bg-transparent text-sm text-[#1a1a1a] border-0 outline-none placeholder-[#999]"
                      />
                    </div>
                    <div className="flex gap-2 flex-wrap">
                      <button onClick={() => setFilterFavorites(!filterFavorites)}
                        className={`px-3 py-1.5 rounded-full text-xs font-bold ${filterFavorites ? "bg-[#dc2626] text-white" : neuBtn + " text-[#1a1a1a]"}`}>
                        ‚≠ê Favorites
                      </button>
                      <select value={sortBy} onChange={e => setSortBy(e.target.value)}
                        className={`${neuBtn} rounded-full px-3 py-1.5 text-xs font-bold text-[#1a1a1a] outline-none`}>
                        <option value="date">Recent</option>
                        <option value="name">Name</option>
                        <option value="views">Views</option>
                      </select>
                      <button onClick={() => setBulkMode(!bulkMode)}
                        className={`px-3 py-1.5 rounded-full text-xs font-bold ${bulkMode ? "bg-[#1a1a1a] text-white" : neuBtn + " text-[#1a1a1a]"}`}>
                        ‚òëÔ∏è Select
                      </button>
                    </div>
                    {bulkMode && selectedApps.size > 0 && (
                      <button onClick={bulkDelete} className={`${neuBtnRed} rounded-xl w-full py-2 text-sm font-bold`}>
                        üóëÔ∏è Delete {selectedApps.size} Selected
                      </button>
                    )}
                  </div>

                  <div className="max-h-96 overflow-y-auto">
                    {filteredApps.map(app => (
                      <div key={app._id} onClick={() => { if (!bulkMode) { setSelectedApp(app); setEditCode(""); }}}
                        className={`p-4 border-b border-[#d0d0d0] cursor-pointer transition-all ${
                          selectedApp?._id === app._id ? neuInset : "hover:bg-[#ddd]"}`}>
                        <div className="flex items-start gap-3">
                          {bulkMode && (
                            <input type="checkbox" checked={selectedApps.has(app._id)}
                              onChange={e => {
                                const newSet = new Set(selectedApps);
                                e.target.checked ? newSet.add(app._id) : newSet.delete(app._id);
                                setSelectedApps(newSet);
                              }}
                              className="mt-1 w-5 h-5"
                            />
                          )}
                          <div className="min-w-0 flex-1">
                            <div className="font-black text-[#1a1a1a] flex items-center gap-2">
                              <span className="text-[#dc2626]">üì±</span>
                              {app.appTitle || app.appName}
                              {app.favorite && <span>‚≠ê</span>}
                            </div>
                            <div className="text-[#666] text-xs flex items-center gap-2 mt-1">
                              <span>v{app.version || 1}</span>
                              <span>‚Ä¢</span>
                              <span>üëÅÔ∏è {app.views || 0}</span>
                            </div>
                            <div className="text-[#888] text-xs mt-1 truncate">{app.prompt}</div>
                          </div>
                          {!bulkMode && (
                            <div className="flex flex-col gap-1">
                              <button onClick={e => toggleFavorite(app, e)}
                                className={`${neuBtn} rounded-full w-8 h-8 flex items-center justify-center text-sm`}>
                                {app.favorite ? "‚≠ê" : "‚òÜ"}
                              </button>
                              <button onClick={e => launchApp(app, e)}
                                className={`${neuBtnBlack} rounded-full w-8 h-8 flex items-center justify-center text-xs`}>
                                ‚ñ∂
                              </button>
                            </div>
                          )}
                        </div>
                      </div>
                    ))}
                    {filteredApps.length === 0 && (
                      <div className="p-6 text-[#888] text-center">
                        {searchQuery || filterFavorites ? "No matching apps" : "No apps yet"}
                      </div>
                    )}
                  </div>
                </div>
              )}

              {/* Log */}
              {log.length > 0 && (
                <div className={`${neuInset} rounded-2xl p-4`}>
                  <div className="text-[#666] font-mono text-xs space-y-1 max-h-32 overflow-y-auto">
                    {log.map((l, i) => (
                      <div key={i} className={l.includes("‚úÖ") ? "text-green-600" : l.includes("‚ùå") ? "text-red-600" : ""}>
                        {l}
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>

            {/* Preview Panel */}
            <div className="lg:col-span-2 space-y-6">
              <div className={`${neu} rounded-[24px] overflow-hidden`}>
                <div className="bg-[#1a1a1a] p-4 flex items-center justify-between flex-wrap gap-3">
                  <div className="flex items-center gap-3">
                    <div className="flex gap-2">
                      <div className="w-3 h-3 rounded-full bg-[#dc2626]"></div>
                      <div className="w-3 h-3 rounded-full bg-[#fbbf24]"></div>
                      <div className="w-3 h-3 rounded-full bg-[#22c55e]"></div>
                    </div>
                    <span className="text-white font-black text-sm">
                      {selectedApp?.appTitle || selectedApp?.appName || "PREVIEW"}
                    </span>
                    {selectedApp && (
                      <span className="text-[#666] text-xs">v{selectedApp.version || 1}</span>
                    )}
                  </div>
                  <div className="flex gap-2 flex-wrap">
                    {selectedApp && (
                      <>
                        <button onClick={() => setShowVersions(true)}
                          className={`${neuBtn} rounded-full px-3 py-2 font-bold text-xs text-[#1a1a1a]`}>
                          üìö
                        </button>
                        <button onClick={() => generateShareLink(selectedApp)}
                          className={`${neuBtn} rounded-full px-3 py-2 font-bold text-xs text-[#1a1a1a]`}>
                          üîó
                        </button>
                        <button onClick={() => exportSingleApp(selectedApp)}
                          className={`${neuBtn} rounded-full px-3 py-2 font-bold text-xs text-[#1a1a1a]`}>
                          üì§
                        </button>
                      </>
                    )}
                    <button onClick={() => setShowCode(!showCode)} disabled={!displayCode}
                      className={`${neuBtn} rounded-full px-4 py-2 font-bold text-xs text-[#1a1a1a] disabled:opacity-50`}>
                      {showCode ? "Preview" : "</>"}
                    </button>
                    {selectedApp && (
                      <button onClick={e => launchApp(selectedApp, e)}
                        className={`${neuBtnBlack} rounded-full px-4 py-2 font-bold text-xs`}>
                        Launch
                      </button>
                    )}
                    {selectedApp && editCode && (
                      <button onClick={updateAndRedeploy} disabled={generating}
                        className={`${neuBtnRed} rounded-full px-4 py-2 font-bold text-xs disabled:opacity-50`}>
                        Redeploy
                      </button>
                    )}
                  </div>
                </div>
                
                <div className="h-[480px] bg-white">
                  {showCode && displayCode ? (
                    <div className="relative h-full">
                      <textarea
                        value={editCode || selectedApp?.code || ""}
                        onChange={e => setEditCode(e.target.value)}
                        className="w-full h-full p-4 font-mono text-xs bg-[#1a1a1a] text-[#e8e8e8] resize-none border-0 outline-none"
                        spellCheck={false}
                      />
                      <div className="absolute bottom-2 right-2 text-[#666] text-xs">
                        {(editCode || selectedApp?.code || "").length} chars
                      </div>
                    </div>
                  ) : displayCode ? (
                    <iframe
                      srcDoc={editCode || selectedApp?.code}
                      className="w-full h-full border-0"
                      sandbox="allow-scripts allow-forms allow-modals allow-popups"
                    />
                  ) : (
                    <div className="h-full flex items-center justify-center">
                      <div className="text-center">
                        {generating ? (
                          <div className={`w-20 h-20 mx-auto mb-4 rounded-full ${neuInset} flex items-center justify-center`}>
                            <span className="text-3xl animate-spin">‚öôÔ∏è</span>
                          </div>
                        ) : (
                          <div className={`w-20 h-20 mx-auto mb-4 rounded-full ${neu} flex items-center justify-center`}>
                            <span className="text-3xl">üì±</span>
                          </div>
                        )}
                        <div className="font-black text-[#1a1a1a] text-lg">
                          {generating ? "BUILDING..." : "APP PREVIEW"}
                        </div>
                        {!generating && (
                          <div className="text-[#888] text-sm mt-2">Build or select an app</div>
                        )}
                      </div>
                    </div>
                  )}
                </div>
              </div>

              {/* App Details Card */}
              {selectedApp && (
                <div className={`${neu} rounded-[24px] p-5`}>
                  <div className="flex flex-wrap items-start justify-between gap-4">
                    <div className="flex-1 min-w-0">
                      <h3 className="font-black text-[#1a1a1a] text-xl flex items-center gap-2">
                        <span className="text-[#dc2626]">üì±</span>
                        {selectedApp.appTitle || selectedApp.appName}
                        {selectedApp.favorite && <span>‚≠ê</span>}
                      </h3>
                      <div className="text-[#666] text-sm mt-3 space-y-1">
                        <div className="flex gap-4 flex-wrap">
                          <span><strong>ID:</strong> <span className="font-mono">{selectedApp.appName}</span></span>
                          <span><strong>Version:</strong> {selectedApp.version || 1}</span>
                          <span><strong>Views:</strong> {selectedApp.views || 0}</span>
                        </div>
                        <div><strong>URL:</strong> <a href={selectedApp.hostedUrl} target="_blank" className="text-[#dc2626] hover:underline">{selectedApp.hostedUrl}</a></div>
                        <div><strong>Model:</strong> {selectedApp.model}</div>
                        <div className="text-[#888] text-xs mt-2">{selectedApp.prompt}</div>
                      </div>
                    </div>
                    <div className="flex gap-2">
                      <button onClick={e => toggleFavorite(selectedApp, e)}
                        className={`${neuBtn} rounded-full w-12 h-12 flex items-center justify-center text-xl`}>
                        {selectedApp.favorite ? "‚≠ê" : "‚òÜ"}
                      </button>
                      <button onClick={e => launchApp(selectedApp, e)}
                        className={`${neuBtnRed} rounded-2xl px-6 py-3 font-black`}>
                        üöÄ Launch
                      </button>
                      <button onClick={e => deleteApp(selectedApp, e)}
                        className={`${neuBtn} rounded-full w-12 h-12 flex items-center justify-center text-xl text-[#dc2626]`}>
                        üóëÔ∏è
                      </button>
                    </div>
                  </div>
                </div>
              )}
            </div>
          </div>
        )}

        {/* Footer */}
        <div className="text-center py-4">
          <div className="inline-flex items-center gap-2 text-[#888] text-sm">
            <span className="w-2 h-2 rounded-full bg-[#dc2626]"></span>
            Powered by Puter
            <span className="w-2 h-2 rounded-full bg-[#1a1a1a]"></span>
          </div>
        </div>
      </div>
    </div>
  );
}
      // prettier-ignore-end

      const rootElement = document.getElementById("container");
      ReactDOMClient.createRoot(rootElement).render(<App />);
    </script>
    <!--
    Agents see LLMs docs:
      Database: https://use-fireproof.com/llms-full.txt
      CallAI: https://use-fireproof.com/callai-llms.txt
      ImgGen: https://use-fireproof.com/imggen-llms.txt
    -->
  </body>
</html>